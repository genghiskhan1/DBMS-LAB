SET SERVEROUTPUT ON

DROP VIEW V1;
DROP TABLE PROJECT;
DROP TABLE EMPLOYEE;
DROP TABLE DEPARTMENT;

CREATE TABLE EMPLOYEE (
SSN NUMBER(10) PRIMARY KEY,
NAME VARCHAR(10) NOT NULL,
DEPTNO NUMBER(10) NOT NULL
);

INSERT INTO EMPLOYEE VALUES(1,'RAM',10);
INSERT INTO EMPLOYEE VALUES(2,'SHARAM',11);
INSERT INTO EMPLOYEE VALUES(3,'GARAM',11);
INSERT INTO EMPLOYEE VALUES(4,'HARAM',10);

CREATE TABLE DEPARTMENT (
DEPTNO NUMBER(10) PRIMARY KEY,
DEPTNAME VARCHAR(10) NOT NULL
);

INSERT INTO DEPARTMENT VALUES(10,'SALES');
INSERT INTO DEPARTMENT VALUES(11,'FINANCE');

CREATE TABLE PROJECT (
SSN NUMBER(10) NOT NULL,
PROJECTNO NUMBER(10) NOT NULL,
PROJECTAREA VARCHAR(20) NOT NULL,
FOREIGN KEY (SSN) REFERENCES EMPLOYEE (SSN) ON DELETE CASCADE,
PRIMARY KEY(SSN)
);

INSERT INTO PROJECT VALUES(1,6,'DATABASE'); 
INSERT INTO PROJECT VALUES(4,7,'TESTING'); 
INSERT INTO PROJECT VALUES(3,4,'DATABASE'); 
INSERT INTO PROJECT VALUES(2,5,'TESTING');

DESC EMPLOYEE;
DESC DEPARTMENT;
DESC PROJECT;

CREATE VIEW V1 AS 
SELECT A.SSN,A.NAME,B.DEPTNAME,C.PROJECTAREA
FROM EMPLOYEE A,DEPARTMENT B,PROJECT C
WHERE A.SSN=C.SSN AND
      C.PROJECTNO>=5 AND
      B.DEPTNAME='SALES';

DECLARE
CURSOR CURR IS 
SELECT *FROM V1;
TEMP CURR%ROWTYPE;

BEGIN
OPEN CURR;
LOOP

 FETCH CURR INTO TEMP;
EXIT WHEN CURR%NOTFOUND;

DBMS_OUTPUT.PUT_LINE('NAME '||TEMP.NAME);
DBMS_OUTPUT.PUT_LINE('SSN '||TEMP.SSN);
DBMS_OUTPUT.PUT_LINE('DEPARTMENT NAME '||TEMP.DEPTNAME);
DBMS_OUTPUT.PUT_LINE('PROJECT AREA '||TEMP.PROJECTAREA);

END LOOP;
DBMS_OUTPUT.PUT_LINE('NUMBER OF RECORDS SELECTED: '||CURR%ROWCOUNT);
END;
/ 